#ifndef CLIENT_H
#define CLIENT_H

#include <mosquitto.h>

struct mosquitto* mqtt_client_init(const char *id);
int mqtt_client_connect(struct mosquitto *mosq, const char *host, int port);
void mqtt_client_subscribe(struct mosquitto *mosq, const char *topic);
void mqtt_client_publish(struct mosquitto *mosq, const char *topic, const char *message);
void mqtt_client_disconnect(struct mosquitto *mosq);
void mqtt_client_cleanup(struct mosquitto *mosq);

#endif

#include <stdio.h>
#include <stdlib.h>
#include <mosquitto.h>
#include<string.h>
#include "client.h"
struct mosquitto* mqtt_client_init(const char *id) {
    mosquitto_lib_init();
    return mosquitto_new(id, true, NULL);
}
int mqtt_client_connect(struct mosquitto *mosq, const char *host, int port) {
    return mosquitto_connect(mosq, host, port, 60);
}
void mqtt_client_subscribe(struct mosquitto *mosq, const char *topic) {
    mosquitto_subscribe(mosq, NULL, topic, 0);
}
void mqtt_client_publish(struct mosquitto *mosq, const char *topic, const char *message) {
    mosquitto_publish(mosq, NULL, topic, strlen(message), message, 0, false);
}
void mqtt_client_disconnect(struct mosquitto *mosq) {
    mosquitto_disconnect(mosq);
}
void mqtt_client_cleanup(struct mosquitto *mosq) {
    mosquitto_destroy(mosq);
    mosquitto_lib_cleanup();
}
